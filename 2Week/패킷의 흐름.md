# 엔드포인트 간 통신 흐름
기본 흐름
* 로컬 엔드포인트 간(같은 노드 내 Pod↔Pod 등)에서 트래픽이 이동할 때:
	* 네트워크 트래픽(패킷)은 먼저 출발 엔드포인트의 정책을 거칩니다. 이때 Cilium의 eBPF가 동작하여 L4(Layer 4) 또는 L7(Layer 7)까지의 보안 정책, 접근 제어, 관찰(Observability), 로깅 등을 적용합니다.
	* 패킷이 도착 엔드포인트로 들어오면, 마찬가지로 도착 엔드포인트의 정책을 한 번 더 통과합니다.

L7 정책 적용
* Layer 7(HTTP, gRPC 등)의 상세 정책도 중간에 연동될 수 있는데, 이 때는 프록시(예: Envoy) 구조가 같이 붙어서 L7 수준의 상세 필터, 로깅, 인증정책 등이 적용됩니다.

소켓 계층(enforcement) 활성화시
* TCP 트래픽에서 소켓 계층 적용(Socket Layer Enforcement)이 활성화되면 최초 연결(TCP Handshake)이 성립하기 전까지 더 엄격한 정책 객체(규칙)가 일련적으로 적용되고, 연결이 완전히 성립된 이후에는 L7 정책이 주로 작동합니다.
* 즉, 연결 수립(TCP state: ESTABLISHED) 전에는 더 깊은 검사, 그 이후에는 효율적으로 정책 적용.

# 엔드포인트에서 나가는(이그레스) 경우
* Egress란 엔드포인트에서 외부(노드 밖/외부 네트워크)로 트래픽을 내보내는 것.
* 경우에 따라 오버레이 네트워크가 중간에 사용될 수 있습니다. (ex: 서로 다른 노드, VPC, cross-cloud 등)
* 오버레이 네트워크는 트래픽을 캡슐화해서(주로 VXLAN, WireGuard) Linux 네트워크 인터페이스(기본값: cilium_vxlan)를 통해 전달합니다.
* eBPF가 여기서도 Egress Policy(L4/L7 등)와 Overlay Encapsulation(필요시 암호화)까지 담당합니다.
* 소켓 계층과 L7 프록시가 활성화되어 있다면, 일부 정책 적용이 최적화되어 정책 처리 단계를 생략하거나 줄일 수 있습니다.
	* L3(네트워크 레벨) 암호화가 옵션으로 들어갈 수도 있음.
	
# 엔드포인트로 들어오는(인그레스) 경우
* Ingress란 외부(노드 밖)에서 엔드포인트로 들어오는 트래픽.
* 오버레이 네트워크가 있는 경우, 트래픽은 먼저 캡슐 해제(디캡슐) 및 암호화 해제(복호화, Decryption) 과정을 거침.
* 그 후에는, 마찬가지로 eBPF 기반 정책 처리 및, 필요시 L7 프록시(Envoy 등)의 심층 분석을 거치게 됩니다.
* 소켓 계층 적용이 활성화된 구조에서는, 프록시와 엔드포인트 소켓 간에 불필요한 정책 처리를 줄일 수 있어서 효율이 올라갑니다.

# 궁극적으로 패킷의 흐름들을 보았을 때, Cilium이 기능적 의미
Cilium은 eBPF를 활용해 네트워크 경로의 각 구간마다(출발, 중간, 도착) 정책(보안) 적용, 암호화, 트래픽 분석이 초고속·프로그램적으로 일어남.

Layer 7(응용계층) 정책이나 프록시(Envoy 등)가 필요한 경우, 필요 구간에만 연동하여 성능 저하 없이 세밀한 보안·관찰이 가능.

오버레이/암호화 구조도 유연히 붙일 수 있어, 복잡한 멀티노드/멀티클라우드 환경에 적합.
